<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoPoint System V2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; }
        .glass-card { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .gold-rank { background: linear-gradient(135deg, #ffd700, #ffb900); color: #7a5d00; }
        .silver-rank { background: linear-gradient(135deg, #e2e8f0, #cbd5e1); color: #475569; }
        .bronze-rank { background: linear-gradient(135deg, #fdba74, #f97316); color: #7c2d12; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="app"></div>

    <script>
        // --- 1. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô ---
        const trashTypes = [
            { id: 1, name: '‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà', points: 10, icon: 'üçæ' },
            { id: 2, name: '‡∏Ç‡∏ß‡∏î‡πÄ‡∏•‡πá‡∏Å', points: 5, icon: 'üß¥' }
        ];

        const rewards = [
            { id: 1, name: '‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤', points: 50, icon: '‚úèÔ∏è' },
            { id: 2, name: '‡∏™‡∏°‡∏∏‡∏î‡πÇ‡∏ô‡πâ‡∏ï', points: 100, icon: 'üìì' }
        ];

        // --- 2. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (State) ---
        let users = JSON.parse(localStorage.getItem('ecopoint_users') || '[]');
        let transactions = JSON.parse(localStorage.getItem('ecopoint_transactions') || '[]');
        let currentUser = null;
        let currentPage = 'home';
        let selectedUserId = null;
        let adminSearchQuery = ''; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤

        const save = () => {
            localStorage.setItem('ecopoint_users', JSON.stringify(users));
            localStorage.setItem('ecopoint_transactions', JSON.stringify(transactions));
        };

        const navigate = (page, userId = null) => {
            currentPage = page;
            selectedUserId = userId;
            render();
        };

        // --- 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ---
        function handleLogin() {
            const id = document.getElementById('login-id').value;
            const pass = document.getElementById('login-pass').value;

            if (id === 'admin' && pass === 'admin123') {
                navigate('admin-dashboard');
                return;
            }

            const user = users.find(u => u.studentId === id && u.password === pass);
            if (user) {
                currentUser = user;
                navigate('student-profile');
            } else {
                alert('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            }
        }

        function addPoints() {
            const trashId = parseInt(document.getElementById('trash-type').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const user = users.find(u => u.id === selectedUserId);

            if (!weight || weight <= 0) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å');

            const type = trashTypes.find(t => t.id === trashId);
            const earned = Math.floor(type.points * weight);

            user.points += earned;
            transactions.push({
                userId: user.id,
                type: type.name,
                points: earned,
                date: new Date().toLocaleString('th-TH')
            });

            save();
            alert(`‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ${user.name} ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ${earned} ‡πÅ‡∏ï‡πâ‡∏°`);
            navigate('admin-dashboard');
        }

        function addUserPrompt() {
            const name = prompt('‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:');
            const sid = prompt('‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:');
            const pass = prompt('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô:');
            if (name && sid && pass) {
                users.push({ id: Date.now(), name, studentId: sid, password: pass, points: 0 });
                save();
                render();
            }
        }

        // --- 4. ‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• UI ---
        function render() {
            const app = document.getElementById('app');

            // ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å: Login
            if (currentPage === 'home') {
                app.innerHTML = `
                    <div class="flex items-center justify-center min-h-screen p-6">
                        <div class="glass-card p-8 rounded-3xl shadow-2xl w-full max-w-md border border-green-100">
                            <div class="text-center mb-8">
                                <span class="text-6xl">‚ôªÔ∏è</span>
                                <h1 class="text-3xl font-bold text-green-700 mt-4">EcoPoint</h1>
                                <p class="text-gray-500 text-sm">‡∏™‡∏∞‡∏™‡∏°‡∏Ç‡∏¢‡∏∞ ‡πÅ‡∏•‡∏Å‡πÅ‡∏ï‡πâ‡∏°‡∏£‡∏±‡∏Å‡∏©‡πå‡πÇ‡∏•‡∏Å</p>
                            </div>
                            <div class="space-y-4">
                                <input id="login-id" type="text" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô / Admin" class="w-full p-4 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-green-500 outline-none ring-1 ring-gray-100">
                                <input id="login-pass" type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" class="w-full p-4 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-green-500 outline-none ring-1 ring-gray-100">
                                <button onclick="handleLogin()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-2xl transition shadow-lg">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                            </div>
                        </div>
                    </div>`;
            }

            // ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô: ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° + ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
            else if (currentPage === 'admin-dashboard') {
                const filteredUsers = users.filter(u => 
                    u.studentId.includes(adminSearchQuery) || u.name.includes(adminSearchQuery)
                );

                app.innerHTML = `
                    <div class="p-6 max-w-4xl mx-auto">
                        <div class="flex justify-between items-center mb-8">
                            <h1 class="text-2xl font-bold text-blue-800">‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Admin üõ†Ô∏è</h1>
                            <button onclick="location.reload()" class="text-gray-500 text-sm bg-white px-4 py-2 rounded-xl shadow-sm">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                            <div class="bg-blue-600 p-6 rounded-3xl text-white shadow-lg flex justify-between items-center">
                                <div><p class="text-sm opacity-80">‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p><p class="text-3xl font-bold">${users.length} ‡∏Ñ‡∏ô</p></div>
                                <button onclick="addUserPrompt()" class="bg-white/20 p-4 rounded-2xl text-2xl font-bold hover:bg-white/30 transition">+</button>
                            </div>
                            <div class="bg-white p-4 rounded-3xl shadow-sm ring-1 ring-black/5">
                                <p class="text-xs text-gray-400 font-bold px-2 uppercase mb-1">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                                <input oninput="adminSearchQuery=this.value; render()" value="${adminSearchQuery}" type="text" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ä‡∏∑‡πà‡∏≠..." class="w-full p-2 bg-transparent text-lg font-bold outline-none">
                            </div>
                        </div>

                        <div class="bg-white rounded-3xl shadow-sm overflow-hidden border border-gray-100">
                            <table class="w-full text-left">
                                <thead class="bg-gray-50 border-b">
                                    <tr class="text-gray-400 text-xs uppercase"><th class="p-5">‡∏ä‡∏∑‡πà‡∏≠-‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th><th class="p-5">‡πÅ‡∏ï‡πâ‡∏°</th><th class="p-5 text-right">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
                                </thead>
                                <tbody>
                                    ${filteredUsers.map(u => `
                                        <tr class="border-b last:border-none">
                                            <td class="p-5"><p class="font-bold">${u.name}</p><p class="text-xs text-blue-500">${u.studentId}</p></td>
                                            <td class="p-5 font-bold text-green-600">${u.points}</td>
                                            <td class="p-5 text-right">
                                                <button onclick="navigate('admin-add', ${u.id})" class="bg-blue-100 text-blue-700 px-4 py-2 rounded-xl text-xs font-bold hover:bg-blue-200">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏¢‡∏∞</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>`;
            }

            // ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
            else if (currentPage === 'admin-add') {
                const user = users.find(u => u.id === selectedUserId);
                app.innerHTML = `
                    <div class="p-6 max-w-md mx-auto">
                        <button onclick="navigate('admin-dashboard')" class="mb-6 text-blue-600 font-bold">‚Üê ‡∏Å‡∏•‡∏±‡∏ö</button>
                        <div class="bg-white p-8 rounded-3xl shadow-xl">
                            <h2 class="text-xl font-bold mb-1">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏¢‡∏∞</h2>
                            <p class="text-blue-600 mb-6 font-bold text-2xl">${user.name}</p>
                            <label class="block text-sm text-gray-500 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏¢‡∏∞</label>
                            <select id="trash-type" class="w-full p-4 bg-gray-50 rounded-2xl mb-4 outline-none ring-1 ring-gray-100">
                                ${trashTypes.map(t => `<option value="${t.id}">${t.icon} ${t.name} (${t.points} ‡πÅ‡∏ï‡πâ‡∏°/‡∏Å‡∏Å.)</option>`).join('')}
                            </select>
                            <label class="block text-sm text-gray-500 mb-2">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)</label>
                            <input id="weight" type="number" step="0.1" placeholder="0.0" class="w-full p-4 bg-gray-50 rounded-2xl mb-8 outline-none text-2xl font-bold ring-1 ring-gray-100">
                            <button onclick="addPoints()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg active:scale-95 transition">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
                        </div>
                    </div>`;
            }

            // ‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô + LEADERBOARD 1-10
            else if (currentPage === 'student-profile') {
                const top10 = [...users].sort((a, b) => b.points - a.points).slice(0, 10);
                app.innerHTML = `
                    <div class="p-6 max-w-md mx-auto">
                        <div class="flex justify-between items-center mb-6">
                            <h1 class="font-bold text-green-800 tracking-tighter">ECOPOINT.STUDENT</h1>
                            <button onclick="location.reload()" class="text-gray-400 text-sm">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
                        </div>

                        <div class="bg-gradient-to-br from-green-500 to-green-700 p-8 rounded-[40px] text-white shadow-2xl mb-10 relative overflow-hidden">
                            <div class="relative z-10">
                                <p class="opacity-80 text-sm">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
                                <h2 class="text-6xl font-bold my-2">${currentUser.points}</h2>
                                <p class="text-sm font-bold opacity-90">${currentUser.name} (ID: ${currentUser.studentId})</p>
                            </div>
                            <div class="absolute -right-4 -bottom-4 text-9xl opacity-10">‚ôªÔ∏è</div>
                        </div>

                        <div class="mb-10">
                            <h3 class="font-bold text-gray-700 mb-4 px-2 flex items-center">
                                <span class="mr-2">üèÜ</span> ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏£‡∏±‡∏Å‡∏©‡πå‡πÇ‡∏•‡∏Å (Top 10)
                            </h3>
                            <div class="space-y-2">
                                ${top10.map((u, index) => {
                                    let rankColor = 'bg-white';
                                    if(index === 0) rankColor = 'gold-rank shadow-md';
                                    else if(index === 1) rankColor = 'silver-rank shadow-sm';
                                    else if(index === 2) rankColor = 'bronze-rank shadow-sm';

                                    return `
                                    <div class="${rankColor} flex items-center justify-between p-4 rounded-2xl transition-all">
                                        <div class="flex items-center">
                                            <span class="w-6 font-bold text-center mr-3">${index + 1}</span>
                                            <div>
                                                <p class="font-bold text-sm leading-none">${u.name}</p>
                                                <p class="text-[10px] opacity-60">${u.studentId}</p>
                                            </div>
                                        </div>
                                        <p class="font-bold">${u.points} ‡πÅ‡∏ï‡πâ‡∏°</p>
                                    </div>`;
                                }).join('')}
                            </div>
                        </div>

                        <div class="bg-white rounded-3xl p-6 shadow-sm border border-gray-50">
                            <h3 class="font-bold mb-4 flex items-center text-gray-700"><span>üéÅ</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h3>
                            <div class="space-y-3">
                                ${rewards.map(r => `
                                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-2xl">
                                        <div class="flex items-center">
                                            <span class="text-2xl mr-3">${r.icon}</span>
                                            <div class="text-left"><p class="font-bold text-gray-800 text-sm">${r.name}</p><p class="text-xs text-green-600">${r.points} ‡πÅ‡∏ï‡πâ‡∏°</p></div>
                                        </div>
                                        <button class="bg-white text-gray-400 px-3 py-1 rounded-lg text-xs font-bold border border-gray-200">‡πÅ‡∏•‡∏Å</button>
                                    </div>`).join('')}
                            </div>
                        </div>
                    </div>`;
            }
        }

        render();
    </script>
</body>
</html>
