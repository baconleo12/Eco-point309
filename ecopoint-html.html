<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô EcoPoint</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, sans-serif; }
    </style>
</head>
<body class="bg-gradient-to-br from-green-50 to-blue-50 min-h-screen">
    <div id="app"></div>

    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏¢‡∏∞
        const trashTypes = [
            { id: 1, name: '‡∏Ç‡∏ß‡∏î‡πÉ‡∏´‡∏ç‡πà', points: 10, icon: 'üçæ' },
            { id: 2, name: '‡∏Ç‡∏ß‡∏î‡πÄ‡∏•‡πá‡∏Å', points: 5, icon: 'üß¥' }
        ];

        const rewards = [
            { id: 1, name: '‡∏õ‡∏≤‡∏Å‡∏Å‡∏≤', points: 50, icon: '‚úèÔ∏è' },
            { id: 2, name: '‡∏™‡∏°‡∏∏‡∏î‡πÇ‡∏ô‡πâ‡∏ï', points: 100, icon: 'üìì' },
            { id: 3, name: '‡∏Ç‡∏ô‡∏°', points: 30, icon: 'üç´' },
            { id: 4, name: '‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô', points: 200, icon: 'üéÆ' },
            { id: 5, name: '‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', points: 500, icon: 'üëï' }
        ];

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('ecopoint_users') || '[]');
        let transactions = JSON.parse(localStorage.getItem('ecopoint_transactions') || '[]');
        let currentPage = 'home';

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function saveData() {
            localStorage.setItem('ecopoint_users', JSON.stringify(users));
            localStorage.setItem('ecopoint_transactions', JSON.stringify(transactions));
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
        function handleLogin() {
            const name = document.getElementById('login-name').value.trim();
            const studentId = document.getElementById('login-id').value.trim();
            
            if (!name || !studentId) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
                return;
            }

            let user = users.find(u => u.studentId === studentId);
            
            if (!user) {
                user = {
                    id: Date.now(),
                    name: name,
                    studentId: studentId,
                    points: 0,
                    totalTrash: 0
                };
                users.push(user);
                saveData();
            }
            
            currentUser = user;
            currentPage = 'dashboard';
            render();
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
        function handleLogout() {
            currentUser = null;
            currentPage = 'home';
            render();
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏•‡∏Å‡∏Ç‡∏¢‡∏∞
        function handleTrashExchange(trashType, weight) {
            if (!weight || weight <= 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
                return;
            }

            const pointsEarned = Math.floor(trashType.points * weight);
            
            users = users.map(u => 
                u.id === currentUser.id 
                    ? { ...u, points: u.points + pointsEarned, totalTrash: u.totalTrash + parseFloat(weight) }
                    : u
            );

            transactions.push({
                id: Date.now(),
                userId: currentUser.id,
                trashType: trashType.name,
                weight: parseFloat(weight),
                points: pointsEarned,
                date: new Date().toLocaleDateString('th-TH')
            });

            currentUser = users.find(u => u.id === currentUser.id);
            saveData();
            
            alert(`‡πÅ‡∏•‡∏Å‡∏Ç‡∏¢‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ${pointsEarned} EcoPoint`);
            render();
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏•‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
        function handleRewardExchange(reward) {
            if (currentUser.points < reward.points) {
                alert('EcoPoint ‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠');
                return;
            }

            if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å ${reward.name} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? (${reward.points} EcoPoint)`)) {
                users = users.map(u => 
                    u.id === currentUser.id 
                        ? { ...u, points: u.points - reward.points }
                        : u
                );
                currentUser = users.find(u => u.id === currentUser.id);
                saveData();
                alert(`‡πÅ‡∏•‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• ${reward.name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
                render();
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å (Login)
        function renderHome() {
            return `
                <div class="max-w-4xl mx-auto pt-8 px-4">
                    <div class="text-center mb-12">
                        <div class="text-6xl mb-4">‚ôªÔ∏è</div>
                        <h1 class="text-4xl font-bold text-green-700 mb-2">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô EcoPoint</h1>
                        <p class="text-gray-600">‡∏ô‡∏ß‡∏±‡∏ï‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏° - ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
                    </div>

                    <div class="grid md:grid-cols-2 gap-8 mb-12">
                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h2 class="text-xl font-bold mb-4 text-green-700">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö / ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h2>
                            <div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium mb-2">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
                                    <input type="text" id="login-name" class="w-full p-2 border rounded" />
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label>
                                    <input type="text" id="login-id" class="w-full p-2 border rounded" />
                                </div>
                                <button onclick="handleLogin()" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition">
                                    ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                                </button>
                            </div>
                        </div>

                        <div class="bg-white p-6 rounded-lg shadow-md">
                            <h2 class="text-xl font-bold mb-4 text-blue-700">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÅ‡∏•‡∏Å‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô</h2>
                            <div class="space-y-3">
                                ${trashTypes.map(trash => `
                                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                        <div class="flex items-center gap-3">
                                            <span class="text-2xl">${trash.icon}</span>
                                            <span class="font-medium">${trash.name}</span>
                                        </div>
                                        <span class="text-green-600 font-bold">${trash.points} EcoPoint/‡∏Å‡∏Å.</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡∏Å‡∏Ç‡∏¢‡∏∞
        function renderExchange() {
            return `
                <div class="max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold mb-6 text-green-700">‡πÅ‡∏•‡∏Å‡∏Ç‡∏¢‡∏∞‡∏£‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h2>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        ${trashTypes.map(trash => `
                            <button onclick="selectTrash(${trash.id})" 
                                id="trash-btn-${trash.id}"
                                class="p-4 rounded-lg border-2 border-gray-200 hover:border-green-300 transition">
                                <div class="text-4xl mb-2">${trash.icon}</div>
                                <div class="font-medium text-sm">${trash.name}</div>
                                <div class="text-green-600 text-xs mt-1">${trash.points} EcoPoint/‡∏Å‡∏Å.</div>
                            </button>
                        `).join('')}
                    </div>

                    <div id="exchange-form" class="hidden bg-white p-6 rounded-lg shadow-md">
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (‡∏Å‡∏¥‡πÇ‡∏•‡∏Å‡∏£‡∏±‡∏°)</label>
                            <input type="number" step="0.1" min="0.1" id="trash-weight" 
                                class="w-full p-2 border rounded" placeholder="0.0" 
                                oninput="updatePoints()" />
                        </div>
                        <div id="points-preview" class="mb-4 p-3 bg-green-50 rounded hidden">
                            <p class="text-green-700">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÑ‡∏î‡πâ: <strong id="preview-points">0</strong> EcoPoint</p>
                        </div>
                        <button onclick="submitExchange()" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition">
                            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å
                        </button>
                    </div>
                </div>
            `;
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö
        function renderLeaderboard() {
            const sortedUsers = [...users].sort((a, b) => b.points - a.points);
            
            return `
                <div class="max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold mb-6 text-yellow-700 flex items-center gap-2">
                        üèÜ ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ô‡∏≥
                    </h2>
                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        ${sortedUsers.length === 0 ? `
                            <div class="p-8 text-center text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>
                        ` : sortedUsers.map((user, index) => `
                            <div class="flex items-center justify-between p-4 border-b ${
                                index === 0 ? 'bg-yellow-50' : index === 1 ? 'bg-gray-50' : ''
                            }">
                                <div class="flex items-center gap-4">
                                    <div class="text-2xl font-bold ${
                                        index === 0 ? 'text-yellow-500' : 
                                        index === 1 ? 'text-gray-400' : 
                                        index === 2 ? 'text-orange-400' : 'text-gray-300'
                                    }">
                                        #${index + 1}
                                    </div>
                                    <div>
                                        <div class="font-medium">${user.name}</div>
                                        <div class="text-sm text-gray-500">${user.studentId}</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="font-bold text-green-600">${user.points} EcoPoint</div>
                                    <div class="text-sm text-gray-500">${user.totalTrash.toFixed(1)} ‡∏Å‡∏Å.</div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
        function renderRewards() {
            return `
                <div class="max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold mb-6 text-purple-700 flex items-center gap-2">
                        üéÅ ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
                    </h2>
                    <div class="mb-4 p-4 bg-blue-50 rounded-lg">
                        <p class="text-sm">EcoPoint ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <strong class="text-lg text-blue-600">${currentUser.points}</strong> ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${rewards.map(reward => `
                            <div class="bg-white p-6 rounded-lg shadow-md">
                                <div class="text-5xl mb-3">${reward.icon}</div>
                                <h3 class="font-bold text-lg mb-2">${reward.name}</h3>
                                <p class="text-purple-600 font-medium mb-3">${reward.points} EcoPoint</p>
                                <button onclick="handleRewardExchange(${JSON.stringify(reward).replace(/"/g, '&quot;')})"
                                    class="w-full py-2 rounded-lg transition ${
                                        currentUser.points >= reward.points
                                            ? 'bg-purple-600 text-white hover:bg-purple-700'
                                            : 'bg-gray-200 text-gray-500 cursor-not-allowed'
                                    }"
                                    ${currentUser.points < reward.points ? 'disabled' : ''}>
                                    ${currentUser.points >= reward.points ? '‡πÅ‡∏•‡∏Å‡πÄ‡∏•‡∏¢' : 'EcoPoint ‡πÑ‡∏°‡πà‡∏û‡∏≠'}
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ô‡∏ß‡∏¥‡πÄ‡∏Å‡∏ä‡∏±‡∏ô
        function renderNav() {
            return `
                <nav class="bg-white shadow-md">
                    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
                        <div class="flex items-center gap-2">
                            <span class="text-green-600 text-3xl">‚ôªÔ∏è</span>
                            <h1 class="text-xl font-bold text-green-700">EcoPoint</h1>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="text-right">
                                <div class="font-medium">${currentUser.name}</div>
                                <div class="text-sm text-green-600 font-semibold">${currentUser.points} EcoPoint</div>
                            </div>
                            <button onclick="handleLogout()" class="p-2 hover:bg-gray-100 rounded-full transition">
                                ‚éã
                            </button>
                        </div>
                    </div>
                    <div class="max-w-6xl mx-auto px-4 flex gap-4 pb-2">
                        <button onclick="changePage('dashboard')" class="px-4 py-2 rounded-t ${currentPage === 'dashboard' ? 'bg-green-100 text-green-700 font-medium' : 'text-gray-600 hover:bg-gray-100'}">
                            ‡πÅ‡∏•‡∏Å‡∏Ç‡∏¢‡∏∞
                        </button>
                        <button onclick="changePage('leaderboard')" class="px-4 py-2 rounded-t ${currentPage === 'leaderboard' ? 'bg-yellow-100 text-yellow-700 font-medium' : 'text-gray-600 hover:bg-gray-100'}">
                            ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö
                        </button>
                        <button onclick="changePage('rewards')" class="px-4 py-2 rounded-t ${currentPage === 'rewards' ? 'bg-purple-100 text-purple-700 font-medium' : 'text-gray-600 hover:bg-gray-100'}">
                            ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
                        </button>
                    </div>
                </nav>
            `;
        }

        // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
        function changePage(page) {
            currentPage = page;
            render();
        }

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏¢‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        let selectedTrash = null;

        function selectTrash(trashId) {
            selectedTrash = trashTypes.find(t => t.id === trashId);
            
            // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°
            trashTypes.forEach(t => {
                const btn = document.getElementById(`trash-btn-${t.id}`);
                if (t.id === trashId) {
                    btn.className = 'p-4 rounded-lg border-2 border-green-500 bg-green-50 transition';
                } else {
                    btn.className = 'p-4 rounded-lg border-2 border-gray-200 hover:border-green-300 transition';
                }
            });
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('exchange-form').classList.remove('hidden');
            document.getElementById('trash-weight').value = '';
            document.getElementById('points-preview').classList.add('hidden');
        }

        function updatePoints() {
            const weight = parseFloat(document.getElementById('trash-weight').value);
            if (weight > 0 && selectedTrash) {
                const points = Math.floor(selectedTrash.points * weight);
                document.getElementById('preview-points').textContent = points;
                document.getElementById('points-preview').classList.remove('hidden');
            } else {
                document.getElementById('points-preview').classList.add('hidden');
            }
        }

        function submitExchange() {
            const weight = parseFloat(document.getElementById('trash-weight').value);
            if (selectedTrash && weight > 0) {
                handleTrashExchange(selectedTrash, weight);
                selectedTrash = null;
            }
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        function render() {
            const app = document.getElementById('app');
            
            if (!currentUser) {
                app.innerHTML = renderHome();
            } else {
                let content = '';
                if (currentPage === 'dashboard') content = renderExchange();
                else if (currentPage === 'leaderboard') content = renderLeaderboard();
                else if (currentPage === 'rewards') content = renderRewards();
                
                app.innerHTML = renderNav() + `<div class="max-w-6xl mx-auto p-4 py-8">${content}</div>`;
            }
        }

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÅ‡∏≠‡∏õ
        render();
    </script>
</body>
</html>